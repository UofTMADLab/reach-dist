window.storyFormat({
	"author": "Mike Spears, mike.spears@utoronto.ca",
	"description": "reach is a twine story format for authoring immersive XR narratives, environments and prototypes.",
	"image": "icon.svg",
	"name": "reach",
	"version": "1.0.61",
	"proofing": false,
	"license": "MIT",
	"url": "https://github.com/UofTMADLab/reach-dist",
	"source": "<!DOCTYPE html>\n<html>\n  <head>\n<script src=\"https://cdn.jsdelivr.net/gh/aframevr/aframe@e850be07c3a96fdfbafbd57c63cd2679fea0fcb1/dist/aframe-master.min.js\"></script>\n<script src=\"https://unpkg.com/aframe-html-shader@0.2.0/dist/aframe-html-shader.min.js\"></script>    <script>!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=3)}([function(t,e,n){(function(t,n){var i;!function(){var r=\"object\"==typeof self&&self.self===self&&self||\"object\"==typeof t&&t.global===t&&t||this||{},o=r._,a=Array.prototype,s=Object.prototype,u=\"undefined\"!=typeof Symbol?Symbol.prototype:null,c=a.push,d=a.slice,h=s.toString,l=s.hasOwnProperty,p=Array.isArray,f=Object.keys,v=Object.create,m=function(){},g=function(t){return t instanceof g?t:this instanceof g?void(this._wrapped=t):new g(t)};e.nodeType?r._=g:(!n.nodeType&&n.exports&&(e=n.exports=g),e._=g),g.VERSION=\"1.9.1\";var y,b=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)}}return function(){return t.apply(e,arguments)}},w=function(t,e,n){return g.iteratee!==y?g.iteratee(t,e):null==t?g.identity:g.isFunction(t)?b(t,e,n):g.isObject(t)&&!g.isArray(t)?g.matcher(t):g.property(t)};g.iteratee=y=function(t,e){return w(t,e,1/0)};var k=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=Array(e+1);for(r=0;r<e;r++)o[r]=arguments[r];return o[e]=i,t.apply(this,o)}},A=function(t){if(!g.isObject(t))return{};if(v)return v(t);m.prototype=t;var e=new m;return m.prototype=null,e},_=function(t){return function(e){return null==e?void 0:e[t]}},E=function(t,e){return null!=t&&l.call(t,e)},C=function(t,e){for(var n=e.length,i=0;i<n;i++){if(null==t)return;t=t[e[i]]}return n?t:void 0},x=Math.pow(2,53)-1,$=_(\"length\"),L=function(t){var e=$(t);return\"number\"==typeof e&&0<=e&&e<=x};g.each=g.forEach=function(t,e,n){var i,r;if(e=b(e,n),L(t))for(i=0,r=t.length;i<r;i++)e(t[i],i,t);else{var o=g.keys(t);for(i=0,r=o.length;i<r;i++)e(t[o[i]],o[i],t)}return t},g.map=g.collect=function(t,e,n){e=w(e,n);for(var i=!L(t)&&g.keys(t),r=(i||t).length,o=Array(r),a=0;a<r;a++){var s=i?i[a]:a;o[a]=e(t[s],s,t)}return o};var S=function(t){return function(e,n,i,r){var o=3<=arguments.length;return function(e,n,i,r){var o=!L(e)&&g.keys(e),a=(o||e).length,s=0<t?0:a-1;for(r||(i=e[o?o[s]:s],s+=t);0<=s&&s<a;s+=t){var u=o?o[s]:s;i=n(i,e[u],u,e)}return i}(e,b(n,r,4),i,o)}};g.reduce=g.foldl=g.inject=S(1),g.reduceRight=g.foldr=S(-1),g.find=g.detect=function(t,e,n){var i=(L(t)?g.findIndex:g.findKey)(t,e,n);if(void 0!==i&&-1!==i)return t[i]},g.filter=g.select=function(t,e,n){var i=[];return e=w(e,n),g.each(t,(function(t,n,r){e(t,n,r)&&i.push(t)})),i},g.reject=function(t,e,n){return g.filter(t,g.negate(w(e)),n)},g.every=g.all=function(t,e,n){e=w(e,n);for(var i=!L(t)&&g.keys(t),r=(i||t).length,o=0;o<r;o++){var a=i?i[o]:o;if(!e(t[a],a,t))return!1}return!0},g.some=g.any=function(t,e,n){e=w(e,n);for(var i=!L(t)&&g.keys(t),r=(i||t).length,o=0;o<r;o++){var a=i?i[o]:o;if(e(t[a],a,t))return!0}return!1},g.contains=g.includes=g.include=function(t,e,n,i){return L(t)||(t=g.values(t)),(\"number\"!=typeof n||i)&&(n=0),0<=g.indexOf(t,e,n)},g.invoke=k((function(t,e,n){var i,r;return g.isFunction(e)?r=e:g.isArray(e)&&(i=e.slice(0,-1),e=e[e.length-1]),g.map(t,(function(t){var o=r;if(!o){if(i&&i.length&&(t=C(t,i)),null==t)return;o=t[e]}return null==o?o:o.apply(t,n)}))})),g.pluck=function(t,e){return g.map(t,g.property(e))},g.where=function(t,e){return g.filter(t,g.matcher(e))},g.findWhere=function(t,e){return g.find(t,g.matcher(e))},g.max=function(t,e,n){var i,r,o=-1/0,a=-1/0;if(null==e||\"number\"==typeof e&&\"object\"!=typeof t[0]&&null!=t)for(var s=0,u=(t=L(t)?t:g.values(t)).length;s<u;s++)null!=(i=t[s])&&o<i&&(o=i);else e=w(e,n),g.each(t,(function(t,n,i){r=e(t,n,i),(a<r||r===-1/0&&o===-1/0)&&(o=t,a=r)}));return o},g.min=function(t,e,n){var i,r,o=1/0,a=1/0;if(null==e||\"number\"==typeof e&&\"object\"!=typeof t[0]&&null!=t)for(var s=0,u=(t=L(t)?t:g.values(t)).length;s<u;s++)null!=(i=t[s])&&i<o&&(o=i);else e=w(e,n),g.each(t,(function(t,n,i){((r=e(t,n,i))<a||r===1/0&&o===1/0)&&(o=t,a=r)}));return o},g.shuffle=function(t){return g.sample(t,1/0)},g.sample=function(t,e,n){if(null==e||n)return L(t)||(t=g.values(t)),t[g.random(t.length-1)];var i=L(t)?g.clone(t):g.values(t),r=$(i);e=Math.max(Math.min(e,r),0);for(var o=r-1,a=0;a<e;a++){var s=g.random(a,o),u=i[a];i[a]=i[s],i[s]=u}return i.slice(0,e)},g.sortBy=function(t,e,n){var i=0;return e=w(e,n),g.pluck(g.map(t,(function(t,n,r){return{value:t,index:i++,criteria:e(t,n,r)}})).sort((function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(i<n||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index})),\"value\")};var I=function(t,e){return function(n,i,r){var o=e?[[],[]]:{};return i=w(i,r),g.each(n,(function(e,r){var a=i(e,r,n);t(o,e,a)})),o}};g.groupBy=I((function(t,e,n){E(t,n)?t[n].push(e):t[n]=[e]})),g.indexBy=I((function(t,e,n){t[n]=e})),g.countBy=I((function(t,e,n){E(t,n)?t[n]++:t[n]=1}));var M=/[^\\ud800-\\udfff]|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff]/g;g.toArray=function(t){return t?g.isArray(t)?d.call(t):g.isString(t)?t.match(M):L(t)?g.map(t,g.identity):g.values(t):[]},g.size=function(t){return null==t?0:L(t)?t.length:g.keys(t).length},g.partition=I((function(t,e,n){t[n?0:1].push(e)}),!0),g.first=g.head=g.take=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[0]:g.initial(t,t.length-e)},g.initial=function(t,e,n){return d.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},g.last=function(t,e,n){return null==t||t.length<1?null==e?void 0:[]:null==e||n?t[t.length-1]:g.rest(t,Math.max(0,t.length-e))},g.rest=g.tail=g.drop=function(t,e,n){return d.call(t,null==e||n?1:e)},g.compact=function(t){return g.filter(t,Boolean)};var T=function(t,e,n,i){for(var r=(i=i||[]).length,o=0,a=$(t);o<a;o++){var s=t[o];if(L(s)&&(g.isArray(s)||g.isArguments(s)))if(e)for(var u=0,c=s.length;u<c;)i[r++]=s[u++];else T(s,e,n,i),r=i.length;else n||(i[r++]=s)}return i};g.flatten=function(t,e){return T(t,e,!1)},g.without=k((function(t,e){return g.difference(t,e)})),g.uniq=g.unique=function(t,e,n,i){g.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=w(n,i));for(var r=[],o=[],a=0,s=$(t);a<s;a++){var u=t[a],c=n?n(u,a,t):u;e&&!n?(a&&o===c||r.push(u),o=c):n?g.contains(o,c)||(o.push(c),r.push(u)):g.contains(r,u)||r.push(u)}return r},g.union=k((function(t){return g.uniq(T(t,!0,!0))})),g.intersection=function(t){for(var e=[],n=arguments.length,i=0,r=$(t);i<r;i++){var o=t[i];if(!g.contains(e,o)){var a;for(a=1;a<n&&g.contains(arguments[a],o);a++);a===n&&e.push(o)}}return e},g.difference=k((function(t,e){return e=T(e,!0,!0),g.filter(t,(function(t){return!g.contains(e,t)}))})),g.unzip=function(t){for(var e=t&&g.max(t,$).length||0,n=Array(e),i=0;i<e;i++)n[i]=g.pluck(t,i);return n},g.zip=k(g.unzip),g.object=function(t,e){for(var n={},i=0,r=$(t);i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n};var j=function(t){return function(e,n,i){n=w(n,i);for(var r=$(e),o=0<t?0:r-1;0<=o&&o<r;o+=t)if(n(e[o],o,e))return o;return-1}};g.findIndex=j(1),g.findLastIndex=j(-1),g.sortedIndex=function(t,e,n,i){for(var r=(n=w(n,i,1))(e),o=0,a=$(t);o<a;){var s=Math.floor((o+a)/2);n(t[s])<r?o=s+1:a=s}return o};var O=function(t,e,n){return function(i,r,o){var a=0,s=$(i);if(\"number\"==typeof o)0<t?a=0<=o?o:Math.max(o+s,a):s=0<=o?Math.min(o+1,s):o+s+1;else if(n&&o&&s)return i[o=n(i,r)]===r?o:-1;if(r!=r)return 0<=(o=e(d.call(i,a,s),g.isNaN))?o+a:-1;for(o=0<t?a:s-1;0<=o&&o<s;o+=t)if(i[o]===r)return o;return-1}};g.indexOf=O(1,g.findIndex,g.sortedIndex),g.lastIndexOf=O(-1,g.findLastIndex),g.range=function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var i=Math.max(Math.ceil((e-t)/n),0),r=Array(i),o=0;o<i;o++,t+=n)r[o]=t;return r},g.chunk=function(t,e){if(null==e||e<1)return[];for(var n=[],i=0,r=t.length;i<r;)n.push(d.call(t,i,i+=e));return n};var P=function(t,e,n,i,r){if(!(i instanceof e))return t.apply(n,r);var o=A(t.prototype),a=t.apply(o,r);return g.isObject(a)?a:o};g.bind=k((function(t,e,n){if(!g.isFunction(t))throw new TypeError(\"Bind must be called on a function\");var i=k((function(r){return P(t,i,e,this,n.concat(r))}));return i})),g.partial=k((function(t,e){var n=g.partial.placeholder,i=function(){for(var r=0,o=e.length,a=Array(o),s=0;s<o;s++)a[s]=e[s]===n?arguments[r++]:e[s];for(;r<arguments.length;)a.push(arguments[r++]);return P(t,i,this,this,a)};return i})),(g.partial.placeholder=g).bindAll=k((function(t,e){var n=(e=T(e,!1,!1)).length;if(n<1)throw new Error(\"bindAll must be passed function names\");for(;n--;){var i=e[n];t[i]=g.bind(t[i],t)}})),g.memoize=function(t,e){var n=function(i){var r=n.cache,o=\"\"+(e?e.apply(this,arguments):i);return E(r,o)||(r[o]=t.apply(this,arguments)),r[o]};return n.cache={},n},g.delay=k((function(t,e,n){return setTimeout((function(){return t.apply(null,n)}),e)})),g.defer=g.partial(g.delay,g,1),g.throttle=function(t,e,n){var i,r,o,a,s=0;n||(n={});var u=function(){s=!1===n.leading?0:g.now(),i=null,a=t.apply(r,o),i||(r=o=null)},c=function(){var c=g.now();s||!1!==n.leading||(s=c);var d=e-(c-s);return r=this,o=arguments,d<=0||e<d?(i&&(clearTimeout(i),i=null),s=c,a=t.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(u,d)),a};return c.cancel=function(){clearTimeout(i),s=0,i=r=o=null},c},g.debounce=function(t,e,n){var i,r,o=function(e,n){i=null,n&&(r=t.apply(e,n))},a=k((function(a){if(i&&clearTimeout(i),n){var s=!i;i=setTimeout(o,e),s&&(r=t.apply(this,a))}else i=g.delay(o,e,this,a);return r}));return a.cancel=function(){clearTimeout(i),i=null},a},g.wrap=function(t,e){return g.partial(e,t)},g.negate=function(t){return function(){return!t.apply(this,arguments)}},g.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},g.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},g.before=function(t,e){var n;return function(){return 0<--t&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},g.once=g.partial(g.before,2),g.restArguments=k;var D=!{toString:null}.propertyIsEnumerable(\"toString\"),F=[\"valueOf\",\"isPrototypeOf\",\"toString\",\"propertyIsEnumerable\",\"hasOwnProperty\",\"toLocaleString\"],N=function(t,e){var n=F.length,i=t.constructor,r=g.isFunction(i)&&i.prototype||s,o=\"constructor\";for(E(t,o)&&!g.contains(e,o)&&e.push(o);n--;)(o=F[n])in t&&t[o]!==r[o]&&!g.contains(e,o)&&e.push(o)};g.keys=function(t){if(!g.isObject(t))return[];if(f)return f(t);var e=[];for(var n in t)E(t,n)&&e.push(n);return D&&N(t,e),e},g.allKeys=function(t){if(!g.isObject(t))return[];var e=[];for(var n in t)e.push(n);return D&&N(t,e),e},g.values=function(t){for(var e=g.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=t[e[r]];return i},g.mapObject=function(t,e,n){e=w(e,n);for(var i=g.keys(t),r=i.length,o={},a=0;a<r;a++){var s=i[a];o[s]=e(t[s],s,t)}return o},g.pairs=function(t){for(var e=g.keys(t),n=e.length,i=Array(n),r=0;r<n;r++)i[r]=[e[r],t[e[r]]];return i},g.invert=function(t){for(var e={},n=g.keys(t),i=0,r=n.length;i<r;i++)e[t[n[i]]]=n[i];return e},g.functions=g.methods=function(t){var e=[];for(var n in t)g.isFunction(t[n])&&e.push(n);return e.sort()};var q=function(t,e){return function(n){var i=arguments.length;if(e&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],a=t(o),s=a.length,u=0;u<s;u++){var c=a[u];e&&void 0!==n[c]||(n[c]=o[c])}return n}};g.extend=q(g.allKeys),g.extendOwn=g.assign=q(g.keys),g.findKey=function(t,e,n){e=w(e,n);for(var i,r=g.keys(t),o=0,a=r.length;o<a;o++)if(e(t[i=r[o]],i,t))return i};var R,H,W=function(t,e,n){return e in n};g.pick=k((function(t,e){var n={},i=e[0];if(null==t)return n;g.isFunction(i)?(1<e.length&&(i=b(i,e[1])),e=g.allKeys(t)):(i=W,e=T(e,!1,!1),t=Object(t));for(var r=0,o=e.length;r<o;r++){var a=e[r],s=t[a];i(s,a,t)&&(n[a]=s)}return n})),g.omit=k((function(t,e){var n,i=e[0];return g.isFunction(i)?(i=g.negate(i),1<e.length&&(n=e[1])):(e=g.map(T(e,!1,!1),String),i=function(t,n){return!g.contains(e,n)}),g.pick(t,i,n)})),g.defaults=q(g.allKeys,!0),g.create=function(t,e){var n=A(t);return e&&g.extendOwn(n,e),n},g.clone=function(t){return g.isObject(t)?g.isArray(t)?t.slice():g.extend({},t):t},g.tap=function(t,e){return e(t),t},g.isMatch=function(t,e){var n=g.keys(e),i=n.length;if(null==t)return!i;for(var r=Object(t),o=0;o<i;o++){var a=n[o];if(e[a]!==r[a]||!(a in r))return!1}return!0},R=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var r=typeof t;return(\"function\"===r||\"object\"===r||\"object\"==typeof e)&&H(t,e,n,i)},H=function(t,e,n,i){t instanceof g&&(t=t._wrapped),e instanceof g&&(e=e._wrapped);var r=h.call(t);if(r!==h.call(e))return!1;switch(r){case\"[object RegExp]\":case\"[object String]\":return\"\"+t==\"\"+e;case\"[object Number]\":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case\"[object Date]\":case\"[object Boolean]\":return+t==+e;case\"[object Symbol]\":return u.valueOf.call(t)===u.valueOf.call(e)}var o=\"[object Array]\"===r;if(!o){if(\"object\"!=typeof t||\"object\"!=typeof e)return!1;var a=t.constructor,s=e.constructor;if(a!==s&&!(g.isFunction(a)&&a instanceof a&&g.isFunction(s)&&s instanceof s)&&\"constructor\"in t&&\"constructor\"in e)return!1}i=i||[];for(var c=(n=n||[]).length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),o){if((c=t.length)!==e.length)return!1;for(;c--;)if(!R(t[c],e[c],n,i))return!1}else{var d,l=g.keys(t);if(c=l.length,g.keys(e).length!==c)return!1;for(;c--;)if(d=l[c],!E(e,d)||!R(t[d],e[d],n,i))return!1}return n.pop(),i.pop(),!0},g.isEqual=function(t,e){return R(t,e)},g.isEmpty=function(t){return null==t||(L(t)&&(g.isArray(t)||g.isString(t)||g.isArguments(t))?0===t.length:0===g.keys(t).length)},g.isElement=function(t){return!(!t||1!==t.nodeType)},g.isArray=p||function(t){return\"[object Array]\"===h.call(t)},g.isObject=function(t){var e=typeof t;return\"function\"===e||\"object\"===e&&!!t},g.each([\"Arguments\",\"Function\",\"String\",\"Number\",\"Date\",\"RegExp\",\"Error\",\"Symbol\",\"Map\",\"WeakMap\",\"Set\",\"WeakSet\"],(function(t){g[\"is\"+t]=function(e){return h.call(e)===\"[object \"+t+\"]\"}})),g.isArguments(arguments)||(g.isArguments=function(t){return E(t,\"callee\")});var z=r.document&&r.document.childNodes;\"object\"!=typeof Int8Array&&\"function\"!=typeof z&&(g.isFunction=function(t){return\"function\"==typeof t||!1}),g.isFinite=function(t){return!g.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},g.isNaN=function(t){return g.isNumber(t)&&isNaN(t)},g.isBoolean=function(t){return!0===t||!1===t||\"[object Boolean]\"===h.call(t)},g.isNull=function(t){return null===t},g.isUndefined=function(t){return void 0===t},g.has=function(t,e){if(!g.isArray(e))return E(t,e);for(var n=e.length,i=0;i<n;i++){var r=e[i];if(null==t||!l.call(t,r))return!1;t=t[r]}return!!n},g.noConflict=function(){return r._=o,this},g.identity=function(t){return t},g.constant=function(t){return function(){return t}},g.noop=function(){},g.property=function(t){return g.isArray(t)?function(e){return C(e,t)}:_(t)},g.propertyOf=function(t){return null==t?function(){}:function(e){return g.isArray(e)?C(t,e):t[e]}},g.matcher=g.matches=function(t){return t=g.extendOwn({},t),function(e){return g.isMatch(e,t)}},g.times=function(t,e,n){var i=Array(Math.max(0,t));e=b(e,n,1);for(var r=0;r<t;r++)i[r]=e(r);return i},g.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},g.now=Date.now||function(){return(new Date).getTime()};var B={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#x27;\",\"`\":\"&#x60;\"},J=g.invert(B),V=function(t){var e=function(e){return t[e]},n=\"(?:\"+g.keys(t).join(\"|\")+\")\",i=RegExp(n),r=RegExp(n,\"g\");return function(t){return t=null==t?\"\":\"\"+t,i.test(t)?t.replace(r,e):t}};g.escape=V(B),g.unescape=V(J),g.result=function(t,e,n){g.isArray(e)||(e=[e]);var i=e.length;if(!i)return g.isFunction(n)?n.call(t):n;for(var r=0;r<i;r++){var o=null==t?void 0:t[e[r]];void 0===o&&(o=n,r=i),t=g.isFunction(o)?o.call(t):o}return t};var K=0;g.uniqueId=function(t){var e=++K+\"\";return t?t+e:e},g.templateSettings={evaluate:/<%([\\s\\S]+?)%>/g,interpolate:/<%=([\\s\\S]+?)%>/g,escape:/<%-([\\s\\S]+?)%>/g};var G=/(.)^/,U={\"'\":\"'\",\"\\\\\":\"\\\\\",\"\\r\":\"r\",\"\\n\":\"n\",\"\\u2028\":\"u2028\",\"\\u2029\":\"u2029\"},X=/\\\\|'|\\r|\\n|\\u2028|\\u2029/g,Q=function(t){return\"\\\\\"+U[t]};g.template=function(t,e,n){!e&&n&&(e=n),e=g.defaults({},e,g.templateSettings);var i,r=RegExp([(e.escape||G).source,(e.interpolate||G).source,(e.evaluate||G).source].join(\"|\")+\"|$\",\"g\"),o=0,a=\"__p+='\";t.replace(r,(function(e,n,i,r,s){return a+=t.slice(o,s).replace(X,Q),o=s+e.length,n?a+=\"'+\\n((__t=(\"+n+\"))==null?'':_.escape(__t))+\\n'\":i?a+=\"'+\\n((__t=(\"+i+\"))==null?'':__t)+\\n'\":r&&(a+=\"';\\n\"+r+\"\\n__p+='\"),e})),a+=\"';\\n\",e.variable||(a=\"with(obj||{}){\\n\"+a+\"}\\n\"),a=\"var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\\n\"+a+\"return __p;\\n\";try{i=new Function(e.variable||\"obj\",\"_\",a)}catch(e){throw e.source=a,e}var s=function(t){return i.call(this,t,g)},u=e.variable||\"obj\";return s.source=\"function(\"+u+\"){\\n\"+a+\"}\",s},g.chain=function(t){var e=g(t);return e._chain=!0,e};var Y=function(t,e){return t._chain?g(e).chain():e};g.mixin=function(t){return g.each(g.functions(t),(function(e){var n=g[e]=t[e];g.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),Y(this,n.apply(g,t))}})),g},g.mixin(g),g.each([\"pop\",\"push\",\"reverse\",\"shift\",\"sort\",\"splice\",\"unshift\"],(function(t){var e=a[t];g.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),\"shift\"!==t&&\"splice\"!==t||0!==n.length||delete n[0],Y(this,n)}})),g.each([\"concat\",\"join\",\"slice\"],(function(t){var e=a[t];g.prototype[t]=function(){return Y(this,e.apply(this._wrapped,arguments))}})),g.prototype.value=function(){return this._wrapped},g.prototype.valueOf=g.prototype.toJSON=g.prototype.value,g.prototype.toString=function(){return String(this._wrapped)},void 0===(i=function(){return g}.apply(e,[]))||(n.exports=i)}()}).call(this,n(1),n(2)(t))},function(t,e){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(t){\"object\"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,\"loaded\",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,\"id\",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){\"use strict\";n.r(e);var i=n(0);function r(t,e){if(!t||!e)return 0;var n=e.x-t.x,i=e.y-t.y;return 0===n?i>=0?180:0:n>0?180-(Math.atan(i/n)*(180/Math.PI)-90):-(Math.atan(i/n)*(180/Math.PI)-90)}function o(t){if(void 0===window.reach_resource_prefix)return t;var e=t.toLowerCase();return e.startsWith(\"http://\")||e.startsWith(\"https://\")||e.startsWith(\"#\")?t:window.reach_resource_prefix.concat(t)}function a(t,e){return 2*t*Math.sin(e/2)}function s(t,e,n){var i=d(n.direction)-d(e.direction),r=h(n.inclination)-h(e.inclination);return{width:a(t,i),height:a(t,r)}}function u(t,e){return(t+e)/2}function c(t){var e=t.split(\" \");return{corner1:{direction:parseFloat(e[0]),inclination:parseFloat(e[1])},corner2:{direction:parseFloat(e[2]),inclination:parseFloat(e[3])}}}function d(t){return t%12/-12*2*Math.PI}function h(t){return t%12/12*2*Math.PI}function l(t,e,n={}){var i=n;if(t){var r=t.split(\" \");for(var o in r){var a=r[o],s=window.reachMixins[a];if(s)for(var u in s)void 0!==s[u]&&(i[u]=s[u]);else console.log(`Reach Warning: mixin not found: ${a}`)}}for(var c in e)void 0!==e[c]&&(i[c]=e[c]);return i.mixin=void 0,i}function p(){return\"xxxxxxxx\".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return(\"x\"==t?e:3&e|8).toString(16)}))}function f(t){return`v${function(t){var e,n=0;if(0===t.length)return n;for(e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}(t)}`}const v=\"reach_default_null_754\";function m(t){if(void 0===t)return{x:0,y:0};var e=t.getAttribute(\"position\");if(void 0===e)return{x:0,y:0};var n=e.split(\",\");return console.log(n),{x:n[0],y:n[1]}}function g(t){return window.story.passage(t)}function y(t){for(var e,n=/({\\s*(.+)\\s*})?\\(\\(\\s*(.+)\\s*\\)\\)/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};e[1]&&(o=JSON.parse(e[1])),r.push({src:e[3],options:o})}return r}function b(t){return{text:t.processedContent.replace(/({\\s*.+\\s*})?`?&?(\\[\\[\\s*.+\\s*\\]\\]|`([^`]+)`|~~\\s*.+\\s*~~|\\(\\(\\s*.+\\s*\\)\\))\\s*\\n?/g,\"\"),options:{direction:0}}}function w(t){return null!==/%.+%/g.exec(t)}function k(t){return null!==/<.+>/g.exec(t)}function A(t){return null!==/'.+'/g.exec(t)}function E(t,e){var n=document.createElement(\"a-entity\"),i=t.options;i.src=t.src,i.videoId=f(i.src),i.video=void 0;var r=l(t.options.mixin,i);return n.setAttribute(\"reach_video\",r),n}function C(t,e){if(!0===t.options.video)return E(t);var n=document.createElement(\"a-entity\"),i=t.options;i.src=t.src;var r=l(t.options.mixin,i);return n.setAttribute(\"reach_sky\",r),n}function x(t){var e=document.createElement(\"a-entity\"),n=t.options;n.link=t.link;var i=l(t.options.mixin,n,{img:t.img});return e.setAttribute(\"reach_image_panel\",i),e}function $(t){var e=document.createElement(\"a-entity\"),n=t.options;n.src=t.src;var i=l(t.options.mixin,n);return e.setAttribute(\"reach_sound\",i),e}function L(t,e,n){var i=void 0,o=void 0;void 0!==t.twinePosition&&(o=!0,i=r(n,t.twinePosition)),void 0!==t.options.direction&&(o=!1,i=t.options.direction);var a=t.options.distance,d=t.options.inclination,h=void 0;if(t.options.width&&!t.options.height?h={x:t.options.width,y:t.options.width}:!t.options.width&&t.options.height?h={x:t.options.height,y:t.options.height}:t.options.width&&t.options.height&&(h={x:t.options.width,y:t.options.height}),void 0!==t.options.corners){var p=c(t.options.corners),f=s(-1*(a||2),p.corner1,p.corner2);o=!1,i=u(p.corner1.direction,p.corner2.direction),d=u(p.corner1.inclination,p.corner2.inclination),h={x:f.width,y:f.height},console.log(f)}var v=document.createElement(\"a-entity\"),m={id:t.options.id,direction:i,directionInDegrees:o,inclination:d,distance:a,scale:t.options.scale,backgroundSize:h,backgroundColor:t.options.backgroundColor,opacity:t.options.opacity,backgroundShape:t.options.backgroundShape,img:t.options.img,color:t.options.color,text:t.text,link:t.link,arrow:t.options.arrow,floor:t.options.floor,onMouseEnter:t.options.onMouseEnter,onMouseLeave:t.options.onMouseLeave,onClick:t.options.onClick},g={direction:e+1,directionInDegrees:!1,backgroundSize:{x:1,y:1},backgroundColor:\"#0000AA\",opacity:.7,color:\"#FFFFFF\",text:t.link},y=l(t.options.mixin,m,g);return v.setAttribute(\"reach_passage_name\",t.link),v.setAttribute(\"reach_text_panel\",y),v}function S(t,e,n){var i=void 0,o=void 0;void 0!==t.twinePosition&&(o=!0,i=r(n,t.twinePosition)),void 0!==t.options.direction&&(o=!1,i=t.options.direction);var a=t.options.distance,d=t.options.inclination,h=void 0;if(t.options.width&&!t.options.height?h={x:t.options.width,y:t.options.width/8.5*11}:!t.options.width&&t.options.height?h={x:t.options.height/11*8.5,y:t.options.height}:t.options.width&&t.options.height&&(h={x:t.options.width,y:t.options.height}),void 0!==t.options.corners){var p=c(t.options.corners),f=s(-1*(a||2),p.corner1,p.corner2);o=!1,i=u(p.corner1.direction,p.corner2.direction),d=u(p.corner1.inclination,p.corner2.inclination),h={x:f.width,y:f.height},console.log(f)}t.backgrounds&&t.backgrounds[0]&&t.backgrounds[0].src;var v=document.createElement(\"a-entity\"),m={id:t.options.id,direction:i,directionInDegrees:o,inclination:d,distance:a,scale:t.options.scale,backgroundSize:h,backgroundColor:t.options.backgroundColor,opacity:t.options.opacity,backgroundShape:t.options.backgroundShape,img:t.options.img,color:t.options.color,text:t.text,arrow:t.options.arrow,onMouseEnter:t.options.onMouseEnter,onMouseLeave:t.options.onMouseLeave,onClick:t.options.onClick},g={direction:2*(e+1),directionInDegrees:!1},y=l(t.options.mixin,m,g);return v.setAttribute(\"reach_passage_name\",t.link),v.setAttribute(\"reach_text_panel\",y),v}function I(t,e,n){var i=void 0,o=void 0;void 0!==t.twinePosition&&(o=!0,i=r(n,t.twinePosition)),void 0!==t.options.direction&&(o=!1,i=t.options.direction);var a=t.options.distance,d=t.options.inclination,h=void 0;if(t.options.width&&!t.options.height?h={x:t.options.width,y:t.options.width/8.5*11}:!t.options.width&&t.options.height?h={x:t.options.height/11*8.5,y:t.options.height}:t.options.width&&t.options.height&&(h={x:t.options.width,y:t.options.height}),void 0!==t.options.corners){var p=c(t.options.corners),f=s(-1*(a||2),p.corner1,p.corner2);o=!1,i=u(p.corner1.direction,p.corner2.direction),d=u(p.corner1.inclination,p.corner2.inclination),h={x:f.width,y:f.height},console.log(f)}t.backgrounds&&t.backgrounds[0]&&t.backgrounds[0].src;var v=document.createElement(\"a-entity\"),m={id:t.options.id,direction:i,directionInDegrees:o,inclination:d,distance:a,scale:t.options.scale,backgroundSize:h,backgroundColor:t.options.backgroundColor,opacity:t.options.opacity,backgroundShape:t.options.backgroundShape,img:t.options.img,text:t.text,link:t.options.link,debugCanvas:t.options.debugCanvas,onMouseEnter:t.options.onMouseEnter,onMouseLeave:t.options.onMouseLeave,onClick:t.options.onClick},g={direction:2*(e+1),directionInDegrees:!1},y=l(t.options.mixin,m,g);return v.setAttribute(\"reach_passage_name\",t.link),v.setAttribute(\"reach_html_panel\",y),v}function M(t,e){this.id=t.getAttribute(\"pid\"),this.name=t.getAttribute(\"name\"),this.tags=t.getAttribute(\"tags\"),this.position=m(t),this.source=t.textContent,this.passageData=t,this.container=e,this.onReadyCallback=void 0,this.deferredCallbacks=[];var n=this;this.onReady((function(){for(var t in n.deferredCallbacks)n.deferredCallbacks[t]();n.deferredCallbacks=void 0}))}var T;M.prototype.destroy=function(){if(void 0!==this.removeCallbacks)for(var t in this.removeCallbacks)console.log(`Removing ${this.name}`),this.removeCallbacks[t](this);this.id=void 0,this.name=void 0,this.tags=void 0,this.position=void 0,this.source=void 0,this.passageData=void 0,this.container=void 0,this.onReadyCallback=void 0,this.deferredCallbacks=void 0},M.prototype.onRemove=function(t){void 0===this.removeCallbacks&&(this.removeCallbacks=[]),this.removeCallbacks.push(t)},M.prototype.onReady=function(t){this.container.addEventListener(\"loaded\",t)},M.prototype.deferIfNecessary=function(t){if(this.deferredCallbacks){var e=this;this.deferredCallbacks.push((function(){t.apply(e)}))}else t.apply(this)},M.prototype.hide=function(){this.container.object3D.visible=!1},M.prototype.show=function(){this.container.object3D.visible=!0},M.prototype.textPanel=function(t,e){var n=S({text:t,options:e||{}},-1);return this.deferIfNecessary((function(){this.container.appendChild(n)})),n.components.reach_text_panel},M.prototype.htmlPanel=function(t,e){var n=I({text:t,options:e||{}},-1);return this.deferIfNecessary((function(){this.container.appendChild(n)})),n.components.reach_html_panel},M.prototype.linkPanel=function(t,e,n){var i=L({text:t,link:e,options:n||{}},-1);return this.deferIfNecessary((function(){this.container.appendChild(i)})),i.components.reach_text_panel},M.prototype.imagePanel=function(t,e,n){var i=x({img:t,link:e,options:n||{}});return this.deferIfNecessary((function(){this.container.appendChild(i)})),i.components.reach_image_panel},M.prototype.sky=function(t,e){var n=C({src:t,options:e||{}},this.name);return this.deferIfNecessary((function(){this.container.appendChild(n)})),n.components.reach_sky},M.prototype.video=function(t,e){var n=E({src:t,options:e||{}},this.name);return this.deferIfNecessary((function(){this.container.appendChild(n)})),n.components.reach_video},M.prototype.videoPanel=function(t,e){var n=document.createElement(\"a-entity\");return void 0===e&&(e={}),e.src=t,n.setAttribute(\"reach_video_panel\",e),this.deferIfNecessary((function(){this.container.appendChild(n)})),n.components.reach_video_panel},M.prototype.sound=function(t,e){var n=$({src:t,options:e||{}});return this.deferIfNecessary((function(){this.container.appendChild(n)})),n.components.reach_sound},M.prototype.custom=function(t,e,n){var i=document.createElement(\"a-entity\");i.setAttribute(\"reach_custom\",{name:t,id:e}),i.components.reach_custom.initCallback=n,this.deferIfNecessary((function(){this.container.appendChild(i)}))},M.prototype.getComponentWithId=function(t,e){if(void 0===e){if(void 0===(n=this.container.querySelector(`#${t}`)))return;e=n.getAttribute(\"reach_component\");return n.components[e]}var n;return(n=this.container.querySelector(`[${e}]#${t}`))?n.components[e]:void 0},M.prototype.getAllComponentsWithId=function(t){for(var e=this.container.querySelectorAll(`[id=\"${t}\"]`),n=[],i=0;i<e.length;i++){var r=e[i],o=r.getAttribute(\"reach_component\");void 0!==o&&n.push(r.components[o])}return n},M.prototype.getAllComponentsWithPassageName=function(t){for(var e=this.container.querySelectorAll(`[reach_passage_name=\"${t}\"]`),n=[],i=0;i<e.length;i++){var r=e[i],o=r.getAttribute(\"reach_component\");n.push(r.components[o])}return n},M.prototype.getAllComponentsOfType=function(t,e){var n=this.container.querySelectorAll(`[${t}]`);return n?void 0===e?Array.prototype.map.call(n,(function(e){return e.components[t]})):Array.prototype.map.call(n,(function(e){return e.components[t]}))[e]:void 0===e?[]:void 0},M.prototype.getSky=function(t){return this.getComponentWithId(t,\"reach_sky\")},M.prototype.skies=function(t){return this.getAllComponentsOfType(\"reach_sky\",t)},M.prototype.getImagePanel=function(t){return this.getComponentWithId(t,\"reach_image_panel\")},M.prototype.imagePanels=function(t){return this.getAllComponentsOfType(\"reach_image_panel\",t)},M.prototype.getSound=function(t){return this.getComponentWithId(t,\"reach_sound\")},M.prototype.sounds=function(t){return this.getAllComponentsOfType(\"reach_sound\",t)},M.prototype.getTextPanel=function(t){return this.getComponentWithId(t,\"reach_text_panel\")},M.prototype.textPanels=function(t){return this.getAllComponentsOfType(\"reach_text_panel\",t)},M.prototype.getHTMLPanel=function(t){return this.getComponentWithId(t,\"reach_html_panel\")},M.prototype.htmlPanels=function(t){return this.getAllComponentsOfType(\"reach_html_panel\",t)},M.prototype.getLinkPanel=function(t){return this.getComponentWithId(t,\"reach_text_panel\")},M.prototype.linkPanels=function(t){return this.getAllComponentsOfType(\"reach_text_panel\",t)},M.prototype.getVideo=function(t){return this.getComponentWithId(t,\"reach_video\")},M.prototype.videos=function(t){return this.getAllComponentsOfType(\"reach_video\",t)},M.prototype.getVideoPanel=function(t){return this.getComponentWithId(t,\"reach_video_panel\")},M.prototype.videoPanels=function(t){return this.getAllComponentsOfType(\"reach_video_panel\",t)},M.prototype.on=function(t,e,n){if(void 0!==t&&\"\"!==t&&void 0!==e){var i=this.name,r=this,o=function(n){try{e(n.detail.source,n,r)}catch(n){return void window.story.showError(n,`${i}(event: ${t})`)}},a=void 0===n?this.container:n.eventTargetElement();return a.addEventListener(t,o),function(){a.removeEventListener(t,o)}}},M.prototype.send=function(t,e){this.container.emit(t,{source:e})},M.prototype.load=function(t,e){e=void 0===e?{}:e;var n=window.story.passage(t);if(void 0===n)throw`Passage.load: Could not find passage named ${t}`;if(!0===w(t))try{if(\"Double-click this passage to edit it.\"===n.textContent)throw\"The passage does not contain JavaScript code.\";return void _.template(`<% ${n.textContent} %>`)({s:n.s,p:window.passage,reach_passage_name:t,params:e})}catch(e){window.story.showError(e,`${this.name} (error in linked code passage named: ${t})`)}else if(!0===k(t))try{var i=I({link:t,text:window.story.render(t,e),backgrounds:[],options:e,twinePosition:m(n)},0,this.position);return void this.container.appendChild(i)}catch(e){throw`${this.name}(loading html passage named: ${t})`}else if(!0===A(t))try{i=S({link:t,text:window.story.render(t,e),backgrounds:[],options:e,twinePosition:m(n)},0,this.position);return void this.container.appendChild(i)}catch(e){throw`${this.name}(loading text passage named: ${t})`}else{var r=document.createElement(\"a-entity\");this.container.appendChild(r);var o=e;o.name=t,o.hideFromHistory=!0,o.attachToWindow=!1,o.params=JSON.stringify(e);try{r.setAttribute(\"reach_passage_name\",t),r.setAttribute(\"reach_passage\",o)}catch(e){throw`${this.name}(loading passage named: ${t})`}}},M.prototype.unload=function(t){if(void 0!==t){var e=[];this.applyToAll(t,(function(t){t.el.remove(),e.push(t)})),this.send(\"unload\",{unloaded:e,name:t})}else this.container.remove()},M.prototype.applyToAll=function(t,e){if(void 0!==t){var n=this.getAllComponentsWithPassageName(t).concat(this.getAllComponentsWithId(t));for(var i in n){e(n[i])}}},AFRAME.registerComponent(\"reach_passage\",{schema:{id:{type:\"string\",default:v},name:{type:\"string\",default:v},hideFromHistory:{type:\"boolean\",default:!1},attachToWindow:{type:\"boolean\",default:!0},params:{type:\"string\",default:\"{}\"},ready:{type:\"boolean\",default:!1}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_passage\"),this.head||(this.head=document.createElement(\"a-entity\"),this.el.appendChild(this.head)),this.codePassages=[];var t=this.head,e=void 0;if(this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id),this.data.name!==v&&(e=window.story.passage(this.data.name)),void 0!==e){this.passage=new M(e,this.head),!1===this.data.hideFromHistory&&window.story.history.push(this.passage.name),!0===this.data.attachToWindow&&(window.passage=this.passage);var n=this;this.passage.onReady(()=>{!1===n.data.ready&&n.setOption(\"ready\",!0)});try{var i=window.story.render(this.passage.name,JSON.parse(this.data.params))}catch(t){return void window.story.showError(t,this.passage.name)}this.passage.processedContent=i;for(var r=y(this.passage),o=0;o<r.length;o++){var a=C(r[o],this.passage.name);null!==a&&t.appendChild(a)}var s=function(t){for(var e,n=/(^|({\\s*(.+)\\s*})|[^`&])\\[;?\\[\\s*((.+)\\s*\\|\\s*(.+)\\s*|(.+)\\s*)\\]\\]/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};if(e[2]&&(o=JSON.parse(e[1])),e[5]){var a=g(e[6]);r.push({text:e[5],link:e[6],options:o,twinePosition:m(a)})}else{a=g(e[7]);r.push({text:e[7],link:e[7],options:o,twinePosition:m(a)})}}return r}(this.passage);for(o=0;o<s.length;o++){var u=s[o];if(!0===w(u.link))this.codePassages.push(u);else if(!0===k(u.link))try{u.text=window.story.render(u.link,u.options),u.backgrounds=[];var c=I(u,o,this.passage.position);t.appendChild(c)}catch(t){return void window.story.showError(t,`${this.passage.name}(loading html passage named: ${u.link})`)}else if(!0===A(u.link))try{u.text=window.story.render(u.link,u.options),u.backgrounds=[];c=S(u,o,this.passage.position);t.appendChild(c)}catch(t){return void window.story.showError(t,`${this.passage.name}(loading text passage named: ${u.link})`)}else{var d=L(u,o,this.passage.position);t.appendChild(d)}}var h=function(t){for(var e,n=/(^|({\\s*(.+)\\s*})|[^`&])\\[\\s*([\\w\\d]+)\\s*\\[(|\\s*(.+)\\s*)\\](\\s*\\]|((.+))\\])/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};if(e[2]&&(o=JSON.parse(e[2])),\"img\"!==e[4]&&\";\"!==e[4]){var a=window.story.parsePassageName(e[4]).parts,s=a.pop();a.push(`%${s}%`),o.codeName=s,o.nsPath=a.join(\".\"),o.parameter1=e[5],o.parameter2=e[8],r.push(o)}}return r}(this.passage);for(o=0;o<h.length;o++){var l=h[o],p=l.nsPath;if(void 0!==(e=window.story.passage(p,window.story,!0)))try{if(\"Double-click this passage to edit it.\"===e.textContent)throw\"The passage does not contain JavaScript code.\";_.template(`<% ${e.textContent} %>`)({s:e.s,p:this.passage,params:l})}catch(t){window.story.showError(t,`${this.passage.name} (error in linked code passage named: ${p})`)}else window.story.showError(\"\",`${this.passage.name}(could not load code passage named: ${p})`)}var f=function(t){for(var e,n=/({\\s*(.+)\\s*})?`\\[\\[\\s*((.+)\\s*\\|\\s*(.+)\\s*|(.+)\\s*)\\]\\]/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};if(e[1]&&(o=JSON.parse(e[1])),e[4]){(s=g(e[5])).processedContent=window.story.render(s.getAttribute(\"pid\"));var a=y(s);r.push({link:e[5],text:b(s).text,options:o,backgrounds:a,twinePosition:m(s)})}else{var s;(s=g(e[6])).processedContent=window.story.render(s.getAttribute(\"pid\"));a=y(s);r.push({link:e[6],text:b(s).text,options:o,backgrounds:a,twinePosition:m(s)})}}return r}(this.passage);for(o=0;o<f.length;o++){c=S(f[o],o,this.passage.position);t.appendChild(c)}var E=function(t){for(var e,n=/(^|({\\s*(.+)\\s*})|[^`&])\\[img\\[(\\s*(.+)\\s*)\\](\\s*\\]|((.+))\\])/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};e[2]&&(o=JSON.parse(e[2])),r.push({img:e[5],link:e[7],options:o})}return r}(this.passage);for(o=0;o<E.length;o++){c=x(E[o]);t.appendChild(c)}var T=function(t){for(var e,n=/({\\s*(.+)\\s*})?~~\\s*(.+)\\s*~~/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};e[1]&&(o=JSON.parse(e[1])),r.push({src:e[3],options:o})}return r}(this.passage);for(o=0;o<T.length;o++){var j=$(T[o]);t.appendChild(j)}if(!0===this.data.attachToWindow&&0===r.length){var O=C({options:{transparent:!1}},this.passage.name);t.appendChild(O)}}else{var P=`reach: could not find passage with name or pid: ${this.data.name}`;window.story.showError(P,this.data.name)}},update:function(t){if(void 0!==this.passage&&!1!==this.data.ready){for(var e=0;e<this.codePassages.length;e++){var n=this.codePassages[e],i=window.story.passage(n.link);if(void 0!==i)try{if(\"Double-click this passage to edit it.\"===i.textContent)throw\"The passage does not contain JavaScript code.\";var o=n.options;o.twineDirection=r(this.passage.position,n.twinePosition)/360*-12,_.template(`<% ${i.textContent} %>`)({s:i.s,p:window.passage,params:o})}catch(t){window.story.showError(t,`${this.passage.name} (error in linked code passage named: ${n.link})`)}else window.story.showError(\"\",`${this.passage.name}(could not load code passage named: ${codePassageName})`)}var a=function(t){for(var e,n=/({\\s*(.+)\\s*})?&\\[;?\\[\\s*((.+)\\s*\\|\\s*(.+)\\s*|(.+)\\s*)\\]\\]/g,i=t.processedContent,r=[];null!==(e=n.exec(i));){var o={};if(e[1]&&(o=JSON.parse(e[1])),e[4]){var a=g(s=e[5]);r.push({name:s,options:o,twinePosition:m(a)})}else{var s;a=g(s=e[6]);r.push({name:s,options:o,twinePosition:m(a)})}}return r}(this.passage);for(e=0;e<a.length;e++){var s=a[e];if(!0!==window.traversedPassages[s.name]){window.traversedPassages[s.name]=!0;var u=document.createElement(\"a-entity\");this.head.appendChild(u);var c=s.options;c.name=s.name,c.hideFromHistory=!0,c.attachToWindow=!1,c.params=JSON.stringify(s.options);try{u.setAttribute(\"reach_passage_name\",s.name),u.setAttribute(\"reach_passage\",c)}catch(t){return void window.story.showError(t,s.name)}}}}},remove:function(){this.head&&(this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.passage.destroy(),this.passage=void 0)},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_passage\",n)},getOption:function(t){return this.data[t]}}),AFRAME.registerComponent(\"reach_text_panel\",{schema:{id:{type:\"string\",default:v},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},distance:{type:\"number\",default:2},scale:{type:\"vec2\",default:{x:1,y:1}},yHeight:{type:\"number\",default:1.6},backgroundSize:{type:\"vec2\",default:{x:1.5,y:1.5/8.5*11}},text:{type:\"string\",default:\"\"},backgroundColor:{type:\"color\",default:\"#ffffff\"},opacity:{type:\"number\",default:.7},backgroundShape:{type:\"string\",default:\"plane\"},img:{type:\"string\",default:v},color:{type:\"color\",default:\"#000000\"},link:{type:\"string\",default:v},arrow:{type:\"boolean\",default:!1},floor:{type:\"boolean\",default:!1},onClick:{type:\"string\",default:v},onMouseEnter:{type:\"string\",default:v},onMouseLeave:{type:\"string\",default:v},onLoaded:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_text_panel\")},update:function(t){this.head||(this.head=document.createElement(\"a-entity\"),this.outer=document.createElement(\"a-entity\"),this.inner=document.createElement(\"a-entity\"),this.background=document.createElement(\"a-entity\"),this.head.appendChild(this.outer),this.outer.appendChild(this.inner),this.inner.appendChild(this.background),this.removeEventListeners=[],this.registerEvents(\"onClick\",this.background,\"click\",\"reach_text_panel\"),this.registerEvents(\"onMouseEnter\",this.background,\"mouseenter\",\"reach_text_panel\"),this.registerEvents(\"onMouseLeave\",this.background,\"mouseleave\",\"reach_text_panel\"),this.registerEvents(\"onLoaded\",this.el,\"loaded\",\"reach_text_panel\",!0),this.el.appendChild(this.head)),this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id);var e=!0===this.data.floor?0:this.data.yHeight,n=!0===this.data.floor&&!1===this.data.arrow?-90:0;this.head.setAttribute(\"position\",`0 ${e} 0`),this.outer.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.inner.setAttribute(\"position\",`0 0 ${-1*this.data.distance}`),this.inner.setAttribute(\"rotation\",`${n} 0 0`),this.background.setAttribute(\"id\",\"background\"),this.background.setAttribute(\"scale\",{x:this.data.scale.x,y:this.data.scale.y,z:1}),!1!==this.data.floor&&!1!==this.data.arrow||(this.background.setAttribute(\"geometry\",`primitive: ${this.data.backgroundShape}; width: ${this.data.backgroundSize.x}; height: ${this.data.backgroundSize.y}`),this.data.img!==v?this.data.img===t.img&&this.data.opacity===t.opacity||this.background.setAttribute(\"material\",`shader: flat; opacity: ${this.data.opacity}; src: ${o(this.data.img)}; transparent: true`):this.background.setAttribute(\"material\",`color: ${this.data.backgroundColor}; shader: flat; opacity: ${this.data.opacity}`),this.data.text===t.text&&this.data.color===t.color||this.background.setAttribute(\"text\",{align:\"center\",color:this.data.color,width:.85,wrapCount:18,value:this.data.text})),this.data.link===v&&this.data.onClick===v&&this.data.onMouseEnter===v&&this.data.onMouseLeave===v||this.background.setAttribute(\"class\",\"clickable\"),this.data.link!==v&&this.background.setAttribute(\"reach_passage_link\",`name: ${this.data.link}; event: click`),!0===this.data.arrow?(void 0===this.arrow&&(this.arrow=document.createElement(\"a-entity\"),this.background.appendChild(this.arrow)),this.arrow.setAttribute(\"reach_arrow\",{distance:0,yHeight:-1*e,opacity:this.data.opacity,color:this.data.backgroundColor,link:this.data.link})):!1===this.data.arrow&&void 0!==this.arrow&&(this.background.removeChild(this.arrow),this.arrow=void 0)},remove:function(){if(this.head){for(var t in this.removeEventListners)this.removeEventListners[t]();this.removeEventListners=[],this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.inner=void 0,this.background=void 0}},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_text_panel\",n)},getOption:function(t){return this.data[t]},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_text_panel, id: ${this.data.id})`)}},eventTargetElement:function(){return this.head}}),AFRAME.registerComponent(\"reach_html_panel\",{schema:{id:{type:\"string\",default:v},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},distance:{type:\"number\",default:2},scale:{type:\"vec2\",default:{x:1,y:1}},yHeight:{type:\"number\",default:1.6},backgroundSize:{type:\"vec2\",default:{x:1.5,y:1.5/8.5*11}},text:{type:\"string\",default:\"\"},backgroundColor:{type:\"color\",default:\"#ffffff\"},opacity:{type:\"number\",default:.7},backgroundShape:{type:\"string\",default:\"plane\"},img:{type:\"string\",default:v},debugCanvas:{type:\"boolean\",default:!1},link:{type:\"string\",default:v},floor:{type:\"boolean\",default:!1},onClick:{type:\"string\",default:v},onMouseEnter:{type:\"string\",default:v},onMouseLeave:{type:\"string\",default:v},onLoaded:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_html_panel\")},update:function(t){this.head||(this.head=document.createElement(\"a-entity\"),this.outer=document.createElement(\"a-entity\"),this.inner=document.createElement(\"a-entity\"),this.background=document.createElement(\"a-entity\"),this.head.appendChild(this.outer),this.outer.appendChild(this.inner),this.inner.appendChild(this.background),this.removeEventListeners=[],this.registerEvents(\"onClick\",this.background,\"click\",\"reach_html_panel\"),this.registerEvents(\"onMouseEnter\",this.background,\"mouseenter\",\"reach_html_panel\"),this.registerEvents(\"onMouseLeave\",this.background,\"mouseleave\",\"reach_html_panel\"),this.registerEvents(\"onLoaded\",this.el,\"loaded\",\"reach_html_panel\",!0),this.outerTextureElement=document.createElement(\"div\"),this.outerTextureElement.setAttribute(\"style\",\"z-index:-1;\"),this.textureElement=document.createElement(\"div\"),this.textureID=\"tex\"+p(),this.textureElement.setAttribute(\"id\",this.textureID),window.htmlTextureRendering.appendChild(this.outerTextureElement),this.outerTextureElement.appendChild(this.textureElement),this.el.appendChild(this.head),!0===this.data.debugCanvas&&(this.debugElement=document.createElement(\"div\"),this.debugTextureID=this.textureID+\"_debug\",this.debugElement.setAttribute(\"id\",this.debugTextureID),window.htmlTextureRendering.appendChild(this.debugElement))),this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id);var e=!0===this.data.floor?0:this.data.yHeight,n=!0===this.data.floor&&!1===this.data.arrow?-90:0;this.head.setAttribute(\"position\",`0 ${e} 0`),this.outer.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.inner.setAttribute(\"position\",`0 0 ${-1*this.data.distance}`),this.inner.setAttribute(\"rotation\",`${n} 0 0`),this.background.setAttribute(\"id\",\"background\"),this.background.setAttribute(\"geometry\",`primitive: ${this.data.backgroundShape}; width: ${this.data.backgroundSize.x}; height: ${this.data.backgroundSize.y}`),this.background.setAttribute(\"scale\",{x:this.data.scale.x,y:this.data.scale.y,z:1}),this.outerTextureElement.setAttribute(\"style\",\"width: 100%; height: 100%; position: fixed; left: 0; top: 0; overflow: hidden; z-index:-1;\"),this.textureElement.setAttribute(\"style\",`width: 2000px; font-size: 128px; padding: 100px; color: #000000; text-align: left; background-color:${this.data.backgroundColor};`),this.textureElement.innerHTML=this.data.text;var i=this.textureID,r=this.background,o=this.debugTextureID;void 0!==this.debugTextureID?r.setAttribute(\"material\",`shader: html; target: #${i}; ratio: height; transparent: true; debug: #${o}; fps: 0.5;`):r.setAttribute(\"material\",`shader: html; target: #${i}; ratio: height; transparent: true; fps: 0.5; `),this.data.link===v&&this.data.onClick===v&&this.data.onMouseEnter===v&&this.data.onMouseLeave===v||this.background.setAttribute(\"class\",\"clickable\"),this.data.link!==v&&this.background.setAttribute(\"reach_passage_link\",`name: ${this.data.link}; event: click`)},remove:function(){if(this.head){for(var t in this.removeEventListners)this.removeEventListners[t]();this.removeEventListners=[],this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.inner=void 0,this.background=void 0,this.outerTextureElement.remove(),this.outerTextureElement=void 0,void 0!==this.debugElement&&(this.debugElement.remove(),this.debugElement=void 0)}},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_html_panel\",n)},getOption:function(t){return this.data[t]},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_html_panel, id: ${this.data.id})`)}},render:function(){this.background.components.material.shader.__render()},eventTargetElement:function(){return this.head}}),AFRAME.registerComponent(\"reach_image_panel\",{schema:{id:{type:\"string\",default:v},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},distance:{type:\"number\",default:2},scale:{type:\"vec2\",default:{x:1,y:1}},yHeight:{type:\"number\",default:1.6},width:{type:\"number\",default:-9999},height:{type:\"number\",default:-9999},opacity:{type:\"number\",default:1},img:{type:\"string\",default:v},link:{type:\"string\",default:v},floor:{type:\"boolean\",default:!1},onClick:{type:\"string\",default:v},onMouseEnter:{type:\"string\",default:v},onMouseLeave:{type:\"string\",default:v},onLoaded:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_image_panel\");var t=this;this.imageLoadedHandler=function(e){if(e.target===t.background){var n=e.target.getObject3D(\"mesh\").material.map.image,i=n.naturalWidth,r=n.naturalHeight;if(0!==i&&0!==r){var o=r/i;if(0!==o){var a=1,s=o;-9999!==t.data.width&&-9999==t.data.height?s=o*(a=t.data.width):-9999==t.data.width&&-9999!==t.data.height?a=(s=t.data.height)/o:-9999!==t.data.width&&-9999!==t.data.height&&(a=t.data.width,s=t.data.height),t.background.setAttribute(\"geometry\",`primitive: plane; width: ${a}; height: ${s}`)}}}}},update:function(t){this.head||(this.head=document.createElement(\"a-entity\"),this.outer=document.createElement(\"a-entity\"),this.inner=document.createElement(\"a-entity\"),this.background=document.createElement(\"a-entity\"),this.head.appendChild(this.outer),this.outer.appendChild(this.inner),this.inner.appendChild(this.background),this.background.addEventListener(\"materialtextureloaded\",this.imageLoadedHandler),this.removeEventListeners=[],this.registerEvents(\"onClick\",this.background,\"click\",\"reach_image_panel\"),this.registerEvents(\"onMouseEnter\",this.background,\"mouseenter\",\"reach_image_panel\"),this.registerEvents(\"onMouseLeave\",this.background,\"mouseleave\",\"reach_image_panel\"),this.registerEvents(\"onLoaded\",this.el,\"loaded\",\"reach_image_panel\",!0),this.el.appendChild(this.head)),this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id);var e=!0===this.data.floor?0:this.data.yHeight,n=!0===this.data.floor?-90:0;this.head.setAttribute(\"position\",`0 ${e} 0`),this.outer.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.inner.setAttribute(\"position\",`0 0 ${-1*this.data.distance}`),this.inner.setAttribute(\"rotation\",`${n} 0 0`),this.background.setAttribute(\"id\",\"background\"),this.background.setAttribute(\"scale\",{x:this.data.scale.x,y:this.data.scale.y,z:1}),this.background.setAttribute(\"geometry\",\"primitive: plane;\"),this.data.img!==v&&this.background.setAttribute(\"material\",`shader: flat; opacity: ${this.data.opacity}; src: ${o(this.data.img)}; transparent: true`),this.data.link===v&&this.data.onClick===v&&this.data.onMouseEnter===v&&this.data.onMouseLeave===v||this.background.setAttribute(\"class\",\"clickable\"),this.data.link!==v&&this.background.setAttribute(\"reach_passage_link\",`name: ${this.data.link}; event: click`)},remove:function(){if(this.head){for(var t in this.removeEventListners)this.removeEventListners[t]();this.removeEventListners=[],this.background&&(console.log(\"removed\"),this.background.removeEventListener(\"materialtextureloaded\",this.imageLoadedHandler)),this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.inner=void 0,this.background=void 0}},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_image_panel\",n)},getOption:function(t){return this.data[t]},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_image_panel, id: ${this.data.id})`)}},eventTargetElement:function(){return this.head}}),AFRAME.registerComponent(\"reach_video_panel\",{schema:{id:{type:\"string\",default:v},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},distance:{type:\"number\",default:2},yHeight:{type:\"number\",default:1.6},opacity:{type:\"number\",default:.7},width:{type:\"number\",default:1},height:{type:\"number\",default:1},onClick:{type:\"string\",default:v},onMouseEnter:{type:\"string\",default:v},onMouseLeave:{type:\"string\",default:v},onLoaded:{type:\"string\",default:v},autoplay:{type:\"boolean\",default:!0},loop:{type:\"boolean\",default:!0},src:{type:\"string\",default:\"#reach-default-360\"},onLoaded:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_video_panel\")},update:function(t){if(this.head||(this.head=document.createElement(\"a-entity\"),this.outer=document.createElement(\"a-entity\"),this.inner=document.createElement(\"a-entity\"),this.background=document.createElement(\"a-video\"),this.head.appendChild(this.outer),this.outer.appendChild(this.inner),this.inner.appendChild(this.background),this.removeEventListeners=[],this.registerEvents(\"onClick\",this.background,\"click\",\"reach_text_panel\"),this.registerEvents(\"onMouseEnter\",this.background,\"mouseenter\",\"reach_text_panel\"),this.registerEvents(\"onMouseLeave\",this.background,\"mouseleave\",\"reach_text_panel\"),this.registerEvents(\"onLoaded\",this.el,\"loaded\",\"reach_text_panel\",!0),this.el.appendChild(this.head)),this.data.src!=t.src&&void 0!==this.data.src&&\"\"!==this.data.src){this.videoId=f(this.data.src);var e=document.querySelector(\"a-assets\");this.videoAsset=e.querySelector(`#${this.videoId}`),null===this.videoAsset&&(this.videoAsset=document.createElement(\"video\"),e.appendChild(this.videoAsset),this.videoAsset.setAttribute(\"src\",o(this.data.src)),this.videoAsset.setAttribute(\"autoplay\",this.data.autoplay),this.videoAsset.setAttribute(\"loop\",this.data.loop),this.videoAsset.setAttribute(\"id\",this.videoId)),this.background.setAttribute(\"src\",`#${this.videoId}`),!0===this.data.autoplay&&this.videoAsset.play()}this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id),this.head.setAttribute(\"position\",`0 ${this.data.yHeight} 0`),this.outer.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.inner.setAttribute(\"position\",`0 0 ${-1*this.data.distance}`),this.inner.setAttribute(\"rotation\",\"0 0 0\"),this.background.setAttribute(\"id\",\"background\"),this.background.setAttribute(\"width\",this.data.width),this.background.setAttribute(\"height\",this.data.height),this.data.onClick===v&&this.data.onMouseEnter===v&&this.data.onMouseLeave===v||this.background.setAttribute(\"class\",\"clickable\")},remove:function(){if(this.head){for(var t in this.removeEventListners)this.removeEventListners[t]();this.removeEventListners=[],this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.inner=void 0,this.background=void 0}},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_video_panel\",n)},getOption:function(t){return this.data[t]},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_video_panel, id: ${this.data.id})`)}},eventTargetElement:function(){return this.head},playVideo:function(){this.videoAsset.play()},stopVideo:function(){this.videoAsset.stop()},pauseVideo:function(){this.videoAsset.pause()}}),AFRAME.registerComponent(\"reach_sound\",{schema:{id:{type:\"string\",default:v},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},distance:{type:\"number\",default:2},yHeight:{type:\"number\",default:1.6},autoplay:{type:\"boolean\",default:!0},loop:{type:\"boolean\",default:!0},src:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_sound\")},update:function(t){this.head&&(this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.soundElement=void 0),this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id),this.head=document.createElement(\"a-entity\"),this.head.setAttribute(\"position\",`0 ${this.data.yHeight} 0`),this.outer=document.createElement(\"a-entity\"),this.outer.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.soundElement=document.createElement(\"a-sound\"),this.soundElement.setAttribute(\"src\",o(this.data.src)),this.soundElement.setAttribute(\"position\",`0 0 ${this.data.distance}`),this.soundElement.setAttribute(\"autoplay\",this.data.autoplay),this.soundElement.setAttribute(\"loop\",this.data.loop),this.head.appendChild(this.outer),this.outer.appendChild(this.soundElement),this.el.appendChild(this.head)},remove:function(){this.head&&(this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.soundElement=void 0)},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_sound\",n)},getOption:function(t){return this.data[t]},pause:function(){this.soundElement.components.sound.pauseSound()},playSound:function(){this.soundElement.components.sound.playSound()},stopSound:function(){this.soundElement.components.sound.stopSound()},eventTargetElement:function(){return this.head}}),AFRAME.registerComponent(\"reach_sky\",{schema:{id:{type:\"string\",default:v},distance:{type:\"number\",default:-9999},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},transparent:{type:\"boolean\",default:!0},opacity:{type:\"number\",default:1},src:{type:\"string\",default:\"#reach-default-360\"},onLoaded:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_sky\")},update:function(t){this.sky||(this.sky=document.createElement(\"a-sky\"),this.el.appendChild(this.sky),this.removeEventListeners=[],this.registerEvents(\"onLoaded\",this.el,\"loaded\",\"reach_sky\",!0)),this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id),t.src!==this.data.src&&this.sky.setAttribute(\"src\",o(this.data.src)),this.sky.setAttribute(\"transparent\",this.data.transparent),this.sky.setAttribute(\"radius\",-9999===this.data.distance?window.story.defaultFarClipping-1:this.data.distance),this.sky.setAttribute(\"opacity\",this.data.opacity),this.sky.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.sky.setAttribute(\"animation\",{property:\"opacity\",to:1,from:0,startEvents:\"materialtextureloaded\"})},remove:function(){if(this.sky){for(var t in this.removeEventListners)this.removeEventListners[t]();this.removeEventListeners=[],this.el.removeChild(this.sky),this.sky=void 0}},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_sky, id: ${this.data.id})`)}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_sky\",n)},getOption:function(t){return this.data[t]},eventTargetElement:function(){return this.sky}}),AFRAME.registerComponent(\"reach_video\",{schema:{id:{type:\"string\",default:\"REACH_DEFAULT_NULL\"},distance:{type:\"number\",default:5e3},direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},autoplay:{type:\"boolean\",default:!0},loop:{type:\"boolean\",default:!0},videoId:{type:\"string\",default:\"video\"},src:{type:\"string\",default:\"#reach-default-360\"},onLoaded:{type:\"string\",default:v}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_video\")},update:function(t){if(this.sky||(this.sky=document.createElement(\"a-videosphere\"),this.el.appendChild(this.sky),this.removeEventListeners=[],this.registerEvents(\"onLoaded\",this.el,\"loaded\",\"reach_video\",!0)),this.data.id!==v&&this.el.setAttribute(\"id\",this.data.id),this.data.src!=t.src){var e=document.querySelector(`#${this.data.videoId}`);if(!e){var n=document.querySelector(\"a-assets\");(e=document.createElement(\"video\")).setAttribute(\"src\",o(this.data.src)),e.setAttribute(\"autoplay\",this.data.autoplay),e.setAttribute(\"loop\",this.data.loop),e.setAttribute(\"id\",this.data.videoId),n.appendChild(e)}this.sky.setAttribute(\"src\",`#${this.data.videoId}`),!0===this.data.autoplay&&e.play()}this.sky.setAttribute(\"radius\",this.data.distance),this.sky.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`)},remove:function(){if(this.sky){for(var t in this.removeEventListners)this.removeEventListners[t]();this.el.removeChild(this.sky),this.sky.destroy()}},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_video, id: ${this.data.id})`)}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_video\",n)},getOption:function(t){return this.data[t]},eventTargetElement:function(){return this.sky}}),AFRAME.registerComponent(\"reach_custom\",{schema:{id:{type:\"string\",default:v},name:{type:\"string\",default:\"custom\"}},init:function(){this.el.setAttribute(\"reach_component\",\"reach_custom\"),void 0!==this.data.id&&this.el.setAttribute(\"id\",this.data.id),void 0!==this.initCallback&&this.initCallback(this)},update:function(t){},remove:function(){},registerEvents:function(t,e,n,i,r=!1){if(this.data.eventNames!==v&&n){var o=this.el,a=this,s=function(u){!0===r&&e.removeEventListener(n,s);var c=a.data[t];if(c!==v){var d=c.split(\" \");for(var h in d){var l=d[h];o.emit(l,{source:o.components[i]})}}};e.addEventListener(n,s),!1===r&&this.removeEventListeners.push((function(){e.removeEventListener(n,s)}))}},onTick:function(t){this.tickCallback=t},hide:function(){this.el.object3D.visible=!1},show:function(){this.el.object3D.visible=!0},setOption:function(t,e){var n={};n[t]=e,this.el.setAttribute(\"reach_custom\",n)},getOption:function(t){return this.data[t]},tick:function(t,e){if(void 0!==this.tickCallback)try{this.tickCallback(this,t,e)}catch(t){return this.tickCallback=void 0,void window.story.showError(t,`${window.passage.name}(onTick: reach_custom, id: ${this.data.id})`)}},eventTargetElement:function(){return this.el}}),AFRAME.registerGeometry(\"arrow\",{schema:{vertices:{default:[\"0.4932 0.1454 0\",\"0.2432 0.1454 0\",\"0.4932 0.1454 0.1\",\"0.2432 0.1454 0.1\",\"0.2432 -0.7615 0\",\"0.2432 -0.7615 0.1\",\"-0.2568 0.1454 0\",\"-0.5068 0.1454 0\",\"-0.5068 0.1454 0.1\",\"-0.2568 0.1454 0.1\",\"-0.2568 -0.7615 0\",\"-0.2568 -0.7615 0.1\",\"-0.0068 0.9011 0.1\",\"-0.0068 0.9011 0\"]},faces:{default:[\"1 3 4\",\"1 4 2\",\"5 2 4\",\"5 4 6\",\"7 10 9\",\"7 9 8\",\"7 11 12\",\"7 12 10\",\"6 12 11\",\"6 11 5\",\"8 14 7\",\"1 2 14\",\"2 7 14\",\"9 10 13\",\"10 4 13\",\"3 13 4\",\"10 12 6\",\"10 6 4\",\"14 13 3\",\"14 3 1\",\"2 5 11\",\"2 11 7\",\"14 8 9\",\"14 9 13\"]}},init:function(t){var e=new THREE.Geometry;e.vertices=t.vertices.map((function(t){var e=t.split(\" \").map((function(t){return parseFloat(t)}));return new THREE.Vector3(e[0],e[1],e[2])})),console.log(e.vertices),e.computeBoundingBox(),t.faces.forEach((function(t){var n=t.split(\" \").map((function(t){return parseInt(t)}));e.faces.push(new THREE.Face3(n[0]-1,n[1]-1,n[2]-1))})),e.mergeVertices(),console.log(e.faces),e.computeFaceNormals(),e.computeVertexNormals(),this.geometry=e}}),AFRAME.registerComponent(\"reach_arrow\",{schema:{direction:{type:\"number\",default:0},directionInDegrees:{type:\"boolean\",default:!1},inclination:{type:\"number\",default:0},distance:{type:\"number\",default:2},yHeight:{type:\"number\",default:0},opacity:{type:\"number\",default:1},color:{type:\"color\",default:\"#000000\"},link:{type:\"string\",default:v}},init:function(){},update:function(t){this.head&&(this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.inner=void 0,this.background=void 0),this.head=document.createElement(\"a-entity\"),this.head.setAttribute(\"position\",`0 ${this.data.yHeight} 0`),this.outer=document.createElement(\"a-entity\"),this.outer.setAttribute(\"rotation\",`${this.data.inclination%12*30} ${!0===this.data.directionInDegrees?this.data.direction:this.data.direction%12*-30} 0`),this.inner=document.createElement(\"a-entity\"),this.inner.setAttribute(\"position\",`0 0 ${-1*this.data.distance}`),this.background=document.createElement(\"a-entity\"),this.background.setAttribute(\"id\",\"arrow\"),this.background.setAttribute(\"geometry\",\"primitive: arrow;\"),this.background.setAttribute(\"rotation\",\"-90 0 0\"),this.background.setAttribute(\"material\",`color: ${this.data.color}; opacity: ${this.data.opacity}`),this.data.link!==v&&(this.background.setAttribute(\"class\",\"clickable\"),this.background.setAttribute(\"reach_passage_link\",`name: ${this.data.link}; event: click`)),this.head.appendChild(this.outer),this.outer.appendChild(this.inner),this.inner.appendChild(this.background),this.el.appendChild(this.head)},remove:function(){this.head&&(this.el.removeChild(this.head),this.head.destroy(),this.head=void 0,this.outer=void 0,this.inner=void 0,this.background=void 0)}}),console.log(\"REACH-1.0.61,61\"),AFRAME.registerComponent(\"reach_passage_link\",{schema:{event:{type:\"string\",default:\"\"},name:{type:\"string\",default:\"\"}},init:function(){var t=this;this.eventHandlerFn=function(){window.story.show(t.data.name)}},update:function(t){var e=this.data,n=this.el;t.event&&e.event!==t.event&&n.removeEventListener(t.event,this.eventHandlerFn),e.event&&n.addEventListener(e.event,this.eventHandlerFn)},remove:function(){var t=this.data,e=this.el;t.event&&e.removeEventListener(t.event,this.eventHandlerFn)}}),AFRAME.registerComponent(\"reach_rotation_reader\",{init:function(){this.hudtext=document.querySelector(\"#hudtext\")},tick:function(){this.hudtext.setAttribute(\"text\",`value: dir:${(this.el.object3D.rotation.y/(2*Math.PI)*-12%12).toFixed(2)} ele:${(this.el.object3D.rotation.x/(2*Math.PI)*12%12).toFixed(2)}`)}}),AFRAME.registerComponent(\"reach-load-local\",{init:function(){T=document,console.log(\"here\"),document.querySelector(\"a-scene\").setAttribute(\"cursor\",\"rayOrigin: mouse\"),document.querySelector(\"a-scene\").setAttribute(\"raycaster\",\"objects: .clickable\"),window.htmlTextureRendering=document.createElement(\"div\"),document.body.appendChild(htmlTextureRendering);var t=T.querySelector(\"tw-storydata\");t.getAttribute(\"startnode\");for(var e=T.querySelector(\"tw-storydata\").querySelectorAll('*[type=\"text/twine-javascript\"]'),n={},i={},r=t.querySelectorAll(\"tw-passagedata\"),a=0;a<r.length;a++){var s=r[a].getAttribute(\"pid\"),u=r[a].getAttribute(\"name\");null!=s&&(n[s]=r[a]),null!=u&&(i[u]=r[a])}window.story={name:t.getAttribute(\"name\"),startnode:t.getAttribute(\"startnode\"),creator:t.getAttribute(\"creator\"),creatorVersion:t.getAttribute(\"creator-version\"),ifid:t.getAttribute(\"ifid\"),zoom:t.getAttribute(\"zoom\"),format:t.getAttribute(\"format\"),formatVersion:t.getAttribute(\"format-version\"),options:t.getAttribute(\"options\"),history:[],state:{},userScripts:e,checkpointName:\"\",atCheckpoing:!1,passages:n,passagesByName:i,currentCursor:void 0,hud:void 0,defaultFarClipping:1e3,extensions:{}},window.passage={},window.reachMixins={},window.story.showError=function(t,e){var n=`reach error (on loading passage named ${e})\\n${t}`;console.log(n)},window.story.registerMixin=function(t,e){window.reachMixins[t]=e},window.story.passage=function(t,e,n){if(void 0!==t){var i,r=void 0!==e?e:window.story,o=!0===n?window.story.parsePassageName(t):{parts:[t],name:t};if(1!==o.parts.length){var a=o.parts,s=a.shift();return void 0===r.extensions[s]?void console.log(`Couldn't find extension named ${s} in ${r.name}.'`):window.story.passage(a.join(\".\"),r)}if(null!=r.passages[o.name])return(i=r.passages[o.name]).s=r,i;if(void 0!==r.passagesByName[o.name])return(i=r.passagesByName[o.name]).s=r,i;for(var u in r.extensions){var c=r.extensions[u],d=window.story.passage(o.name,c);if(void 0!==d)return d}}},window.story.parsePassageName=function(t){console.log(`path: ${typeof t}`);var e=t.split(\".\");return{parts:e,name:e[e.length-1]}},window.story.render=function(t,e){if(void 0!==t){var n=window.story.passage(t);if(void 0!==n)return _.template(n.textContent)({s:n.s,p:window.passage,params:e});window.story.showError(\"\",\"Error: passage was not found: \"+t)}},window.story.renderCode=function(t,e){return _.template(`<% ${t} %>`)(e)},window.story.show=function(t,e){var n=document.querySelectorAll(\"video\");if(null!==n)for(var i=0;i<n.length;i++)console.log(`pausing video ${i}`),n[i].pause();var r=document.querySelector(\"#container\");for(r.querySelectorAll(\"[reach_passage]\");r.firstChild;){var o=r.firstChild;o.removeAttribute&&o.removeAttribute(\"reach_passage\"),o.remove(),o.destroy&&o.destroy()}window.traversedPassages={};var a=window.story.passage(t);if(void 0!==a){var s=a.getAttribute(\"name\");void 0!==s&&(window.traversedPassages[s]=!0)}var u=document.createElement(\"a-entity\");r.appendChild(u),u.setAttribute(\"reach_passage\",{id:t,name:t,hideFromHistory:e}),document.querySelector(\"a-scene\").setAttribute(\"background\",\"color: black\")},window.story.start=function(){window.story.show(window.story.startnode)},window.story.on=function(t,e){document.querySelector(\"#container\").addEventListener(t,(function(t){e(t.detail.source,t)}))},window.story.stats=function(t){!0===t?document.querySelector(\"a-scene\").setAttribute(\"stats\",!0):document.querySelector(\"a-scene\").removeAttribute(\"stats\")},window.story.cursor=function(t){if(!0===t){if(void 0===window.story.currentCursor){var e=document.createElement(\"a-entity\");e.setAttribute(\"cursor\",\"\"),window.story.currentCursor=e,e.setAttribute(\"raycaster\",\"objects: .clickable\"),e.setAttribute(\"animation__click\",\"property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1\"),e.setAttribute(\"animation__mouseenter\",\"property: scale; startEvents: mouseenter; easing: easeInCubic; dur: 100; from: 1 1 1; to: 1.2 1.2 1.2\"),e.setAttribute(\"animation__mouseleave\",\"property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 100; to: 1 1 1\"),e.setAttribute(\"material\",\"color: black; shader: flat\"),e.setAttribute(\"position\",\"0 0 -1\"),e.setAttribute(\"geometry\",\"primitive: ring; radiusInner: 0.01; radiusOuter: 0.02;\"),document.querySelector(\"#main-camera\").appendChild(e)}}else null!=window.story.currentCursor&&(document.querySelector(\"#main-camera\").removeChild(window.story.currentCursor),window.story.currentCursor=void 0)},window.story.lookPosition=function(t){if(!0===t){if(void 0===window.story.hud){var e=document.createElement(\"a-entity\");e.setAttribute(\"position\",\"0 0 -1\"),e.setAttribute(\"text\",\"value: 0 0\"),e.setAttribute(\"id\",\"hudtext\"),e.setAttribute(\"geometry\",\"primitive: plane; width:auto; height:auto};\"),e.setAttribute(\"material\",\"color:  #000000;  shader:  flat; opacity: 0.3;\"),window.story.hud=e;var n=document.querySelector(\"a-camera\");n.appendChild(e),n.setAttribute(\"reach_rotation_reader\",\"\")}}else void 0!==window.story.hud&&(document.querySelector(\"a-camera\").removeChild(window.story.hud),document.querySelector(\"a-camera\").removeAttribute(\"reach_rotation_reader\"),window.story.hud=void 0)},window.story.isMobile=function(){return AFRAME.utils.device.isMobile()},window.story.headsetConnected=function(){return AFRAME.utils.device.checkHeadsetConnected()},window.story.import=function(t,e){void 0===window.story.pendingImports&&(window.story.pendingImports={});var n=p();window.story.pendingImports[n]={src:t,moduleName:e,context:this}},window.story.finishedImport=function(t){delete window.story.pendingImports[t],0===Object.keys(window.story.pendingImports).length&&window.story.start()},window.story.doImport=function(t,e,n,i){if(void 0!==t&&void 0!==e){var r=new XMLHttpRequest;r.open(\"GET\",t),r.responseType=\"document\",r.overrideMimeType(\"text/html\");var o=n;r.onload=function(){if(r.readyState===r.DONE&&200===r.status){for(var n=r.responseXML,a=n.querySelector(\"tw-storydata\"),s=n.querySelector(\"tw-storydata\").querySelectorAll('*[type=\"text/twine-javascript\"]'),u={},c={},d=a.querySelectorAll(\"tw-passagedata\"),h=0;h<d.length;h++){var l=d[h].getAttribute(\"pid\"),p=d[h].getAttribute(\"name\");null!=l&&(u[l]=d[h]),void 0!==p&&(c[p]=d[h])}o.extensions[e]={name:a.getAttribute(\"name\"),startnode:a.getAttribute(\"startnode\"),creator:a.getAttribute(\"creator\"),creatorVersion:a.getAttribute(\"creator-version\"),ifid:a.getAttribute(\"ifid\"),zoom:a.getAttribute(\"zoom\"),format:a.getAttribute(\"format\"),formatVersion:a.getAttribute(\"format-version\"),options:a.getAttribute(\"options\"),history:[],state:{},userScripts:s,checkpointName:\"\",atCheckpoing:!1,passages:u,passagesByName:c,currentCursor:void 0,hud:void 0,defaultFarClipping:1e3,extensions:{},import:window.story.import};var f=o.extensions[e];for(h=0;h<s.length;h++){var v=s[h].innerHTML;try{_.template(\"<%\"+v+\"%>\")({s:f.state,story:o})}catch(t){console.log(t)}}void 0!==window.passage&&void 0!==window.passage.container&&window.passage.container.emit(\"reachImportLoaded\",{source:f}),console.log(`Imported extension ${f.name} as ${e}.`),window.story.finishedImport(i)}else console.log(`Error loading extension from ${t}.`)},r.send()}},window.story.preloadImages=function(t){var e=0,n=0;for(var i in t){e+=1;var r=i,a=o(t[i]),s=document.createElement(\"img\");s.setAttribute(\"crossorigin\",\"anonymous\"),s.setAttribute(\"id\",r),s.setAttribute(\"src\",a),s.addEventListener(\"load\",(function(t){n+=1,window.passage.container.emit(\"reach_imagePreLoaded\",{source:{src:t.target.getAttribute(\"src\"),count:n,total:e}})})),T.querySelector(\"a-assets\").appendChild(s)}};for(a=0;a<e.length;a++){var c=e[a].innerHTML;try{_.template(\"<%\"+c+\"%>\")({s:window.story})}catch(t){console.log(t)}}if(null!==window.reach_preload_images&&window.story.preloadImages(window.reach_preload_images),!0===window.story.isMobile()&&window.story.cursor(!0),document.addEventListener(\"keydown\",t=>{!0===t.ctrlKey&&!0===t.altKey&&(\"KeyD\"===t.code?void 0===window.story.hud?(window.story.lookPosition(!0),window.story.cursor(!0)):(window.story.lookPosition(!1),window.story.cursor(!1)):\"KeyP\"===t.code?void 0===document.querySelector(\"a-scene\").components.stats?window.story.stats(!0):window.story.stats(!1):\"KeyC\"===t.code&&(void 0===window.story.currentCursor?window.story.cursor(!0):window.story.cursor(!1)))}),void 0===window.story.pendingImports)window.story.start();else for(var d in window.story.pendingImports){var h=window.story.pendingImports[d];window.story.doImport(h.src,h.moduleName,h.context,d)}}});var j=document.querySelector(\"a-scene\");null!=j&&j.setAttribute(\"reach-load-local\",!0),window._=i}]);</script>\n    <title>{{STORY_NAME}}</title>\n  </head>\n  <body>\n    {{STORY_DATA}}\n    <a-scene reach-load-local>\n      <a-assets><img src=\"https://cdn.jsdelivr.net/gh/UofTMADLab/reach-dist/reachDefaultRoom.png\" id=\"reach-default-360\"/ crossorigin=\"anonymous\"> </a-assets>\n<a-entity id=\"container\"> </a-entity>\n      <a-entity laser-controls=\"hand: right\"></a-entity>\n      <a-camera id=\"main-camera\" wasd-controls=\"enabled: false\">\n </a-camera>\n    </a-scene>\n</body>\n</html>\n\n"
});

